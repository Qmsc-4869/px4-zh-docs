# 电调校准

::: info
这些说明仅适用于[PWM电调](../peripherals/pwm_escs_and_servo.md)和[OneShot电调](../peripherals/oneshot.md)。
[DShot](../peripherals/dshot.md)和[CAN](../can/index.md)电调（[DroneCAN](../dronecan/escs.md)/Cyphal）不需要此类校准。
:::

电子调速器（电调）根据飞控发出的输入指令调节电机转速（和方向）。电调对输入命令的响应范围通常可配置，即使同型号电调的默认范围也可能存在差异。

此校准过程将所有电调的飞控输入最大值（2000us）和最小值（1000us）设置为固定PWM范围。随后，机体上的所有电调/电机将对飞控输入在整个范围内产生统一的响应。

推荐所有支持的PWM/OneShot电调都使用此工具进行校准。

::: info
校准对低成本电调尤为重要，因为它们对输入的响应差异通常较大。

但也建议用于高质量控制器。即使这些控制器经过出厂校准且理论上响应一致，实际输入范围仍可能存在差异。例如，若控制器在出厂后被手动校准过，其行为可能已发生变化。
:::

:::warning
如果使用不支持此校准的电调，必须确保其出厂校准且开箱即可稳定工作。需要通过[执行器测试](../config/actuators.md#actuator-testing)进行验证。
跳转至[执行器配置步骤（7）](#actuatorconfig_step)（仍需执行此重要步骤）。
:::

OneShot电调在校准前应[配置为使用OneShot](../peripherals/oneshot.md#px4-configuration)。即使之前已校准过，切换后仍需重新校准电调。

## 预条件

校准序列需要您能够在保持飞控供电的情况下，手动断开/连接电调电源。

如果使用Pixhawk飞控，推荐的方式是通过USB单独为飞控供电，并在需要时通过连接/断开电池为电调供电。
无法通过USB为自动驾驶仪供电的飞控系统将需要[不同的方法](#problem_power_module)。

如果电池通过电源模块连接，校准过程可以检测电池连接状态并利用它来驱动校准序列。
如果无法检测到电池供电，校准过程将基于超时机制执行。

## 步骤

要校准电调：

1. 移除螺旋桨。

   :::warning
   切勿在安装螺旋桨的情况下进行电调校准！

   校准期间电机_应_不会旋转。
   但是，如果在电调已通电的情况下开始校准，或电调不支持/无法检测到校准序列，则电调会以最大速度运行电机以响应PWM输入。
   :::

1. 在机体的[执行器配置](../config/actuators.md)中将校准的电调映射为电机。
   仅映射的执行器会有输出，且只有作为电机映射的电调才会被校准。

1. 通过拔掉电池断开电调的供电。
   飞控必须保持通电，例如通过保持USB连接地面站。

1. 打开 _QGroundControl_ 的 **设置 > 电源**，然后按下 **校准** 按钮。

   ![电调校准步骤 1](../../assets/qgc/setup/esc/qgc_esc_calibration.png)

1. 在无错误情况下启动校准序列后，立即为电调供电（您将收到提示）：

   ![电调校准步骤 2](../../assets/qgc/setup/esc/esc_calibration_step_2.png)

   校准将自动开始：

   ![电调校准步骤 3](../../assets/qgc/setup/esc/esc_calibration_step_3.png)

1. 校准期间，您将听到电调发出的特有蜂鸣声，表示校准的各个步骤。

   完成校准后会收到提示。

   <a id="actuatorconfig_step"></a>
   ![电调校准步骤 4](../../assets/qgc/setup/esc/esc_calibration_step_4.png)

1. 返回[执行器配置](../config/actuators.md)部分。

   电调校准后，所有使用相同（重新）校准电调的电机应对相同输入以相同方式响应。执行器配置中电机输出的默认PWM设置现在应能直接使用。

   您需要确认电机确实能正常工作。
   由于默认配置值设置得较为保守，您可能还需要根据特定电调进行调校。

   ::: info
   下面步骤与[执行器配置 > 电机配置](../config/actuators.md#motor-configuration)中描述的步骤类似。
   :::

   验证以下值：

   - 电机的最小值（默认：`1100us`）应使电机缓慢但可靠地旋转，并在停止后可靠地重新启动。

     您可以通过在[执行器测试](../config/actuators.md#actuator-testing)中启用滑块，然后将测试输出滑块移至底部的第一级卡位，确认电机在最小值下是否可靠旋转（仍无螺旋桨）。
     正确的值应在您将滑块从未启用状态移至最小值时立即且可靠地使电机旋转。

     要找到"最佳"最小值，先将滑块移至底部（未启用）。
     然后以小增量（例如1025us、1050us等）逐步增加PWM输出的`未启用`设置，直到电机可靠启动（最好略高而非略低）。
     将此值输入所有电机PWM输出的`最小值`设置，并将`未启用`输出恢复为`1100us`。

   - 电机的最大值（默认：`1900us`）应选择为增加该值不会使电机转速加快。

     您可以通过在[执行器测试](../config/actuators.md#actuator-testing)中将相关测试输出滑块移至顶部位置，确认电机在最大值设置下快速旋转。

     要找到"最佳"最大值，首先将滑块移至底部（未启用）。
     然后将PWM输出的`未启用`设置增加到接近默认最大值（1900）- 电机应加速。
     当您以增量（例如1925us、1950us等）逐步增加输出的PWM最大值时，注意电机的音调变化。
     当电机声音在增加输出值时不再变化时，就找到了最佳值。
     将此值输入所有电机PWM输出的`最大值`设置，并将`未启用`输出恢复为`1100us`。

   - 电机的未启用值（默认：`1000us`）应使电机停止并保持停止。

     您可以通过在[执行器测试](../config/actuators.md#actuator-testing)中将测试输出滑块移至底部的卡位位置并观察电机是否不旋转来确认这一点。

     如果电调在默认值1000us下旋转，则电调未正确校准。
     如果使用无法校准的电调，应将PWM输出值降低到电机不再旋转的值（例如950us或900us）。

   ::: info
   垂直起降（VTOL）和固定翼飞机的电机无需任何特殊的PWM配置。
   在默认PWM配置下，它们将在飞行过程中由飞控指令自动停止。
   :::

## 故障排除

1. 校准可能在失败的情况下显示为成功

   这发生在您未在正确时间给电调供电，或电调不支持校准的情况下。  
   这是因为PX4无法通过电调反馈来确认校准是否成功。  
   您必须通过解读校准过程中的蜂鸣声和后续电机测试来判断校准是否成功。

   <a id="problem_power_module"></a>

1. 如果配置并连接了电源模块，校准将无法启动（出于安全原因）。

   请首先断开电调的电源。  
   如果电源模块是维持飞控运行的必要条件，但您可以独立控制电调的供电，可以通过参数 [BATn_SOURCE](../advanced_config/parameter_reference.md#BAT1_SOURCE) 临时禁用电源模块检测（仅针对电调校准）。一旦自动飞控的供电模块不再被识别为电池，即可进行基于时间的校准。

1. 如果系统检测到校准启动后电流消耗立即增加，PX4会中止校准（出于安全原因）。  
   此功能需要电源模块。