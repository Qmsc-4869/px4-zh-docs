# 地理围栏

地理围栏是一种虚拟边界，用于定义机体可以飞行的区域。  
地理围栏可用于防止机体超出遥控器的范围，或进入不安全或受限制的空域。

PX4 提供了两种独立的机制来指定地理围栏：  

- 一种基本的"故障安全"地理围栏，定义一个简单的圆柱体。  
- 更复杂的几何形状可以使用地理围栏计划（_QGroundControl_）定义。

::: info  
地理围栏适用于所有模式，包括任务和手动飞行。  
:::

## 故障安全地理围栏  

[地理围栏故障安全](../config/safety.md#geofence-failsafe) 定义了一个以家点为中心的圆柱体，具有指定的最大半径和高度。  

设置还包括在围栏被突破时的"故障安全动作"。这可能只是一个警告通知，但更常见的是机体将立即[返回](../flight_modes/return.md)到安全位置。  

更多信息请参见：[安全 > 地理围栏故障安全](../config/safety.md#geofence-failsafe)。  

## 地理围栏计划  

PX4 支持由多个圆形和多边形区域组成的复杂地理围栏边界，可以定义为包含区（在内飞行）或排除区（在外飞行）。  

地理围栏计划在 _QGroundControl_ 中与任务和集结点一起制定。  

![地理围栏计划](../../assets/qgc/plan_geofence/geofence_overview.jpg)  

地理围栏计划的完整文档请参见 [计划视图 > 地理围栏](https://docs.qgroundcontrol.com/master/en/qgc-user-guide/plan_view/plan_geofence.html)（QGroundControl 用户指南）。  

简要步骤如下：  

1. 打开 _QGroundControl > 计划视图_。  
1. 选择 _计划类型_ 单选按钮：**围栏**。  
   这将显示 _地理围栏编辑器_。  
   ![地理围栏计划](../../assets/qgc/plan_geofence/geofence_editor.jpg)  
1. 选择 **多边形围栏** 或 **圆形围栏** 按钮，将所需类型的围栏添加到地图上。  
   这也会在编辑器中添加一个围栏类型的条目。  
1. 使用地图配置围栏的形状和位置。  
   - 可通过中心标记移动围栏到正确位置。  
   - 可通过圆形围栏边界的标记调整半径。  
   - 可通过角点（顶点）标记调整多边形的几何形状。  
     通过在现有标记之间的中点点击，可创建额外的顶点。  
1. 使用 _地理围栏编辑器_ 将围栏设置为包含区或排除区，并选择要编辑的围栏（**编辑** 单选按钮）或删除（**Del** 按钮）。  
1. 可添加任意数量的围栏。  
1. 完成后，点击右上角的 **上传** 按钮，将围栏（包括集结点和任务）发送到机体。  
1. 在 [地理围栏故障安全](../config/safety.md#geofence-failsafe) 中设置突破动作。  

::: info  
任何不包含家点的地理围栏将被飞控拒绝并无法上传。  
如果机体正在飞行，任何上传后会立即被突破的地理围栏也会被拒绝。  
:::  

::: info  
PX4 实现了 MAVLink [任务微服务](https://mavlink.io/en/services/mission.html)，其中包括对地理围栏的支持。  
:::